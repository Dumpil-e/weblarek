# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run dev
```

или

```
yarn
yarn dev
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Интернет-магазин «Web-Larёk»
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`


#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

# Модели данных
## Класс ProductCatalog
Отвечает за хранение и выбор товаров каталога.

Поля:
products: IProduct[] — массив товаров

selectedProduct: IProduct | null — выбранный товар

Методы:
setProducts(products: IProduct[]) — сохраняет массив товаров и эмитит событие catalog:changed

getProducts() — возвращает список товаров

getProductById(id: string) — ищет товар по ID

setSelectedProduct(product: IProduct) — сохраняет выбранный товар и эмитит событие catalog:selected

getSelectedProduct() — возвращает выбранный товар

## Класс Basket
Отвечает за корзину покупок.

Поля:
items: IProduct[] — список товаров в корзине

Методы:
getItems() — возвращает товары в корзине

addItem(product: IProduct) — добавляет товар и вызывает событие изменения

removeItem(product: IProduct) — удаляет товар и вызывает событие изменения

clear() — очищает корзину и вызывает событие изменения

getTotal() — считает общую сумму

getCount() — возвращает количество товаров

contains(id: string) — проверяет наличие товара

emitChanged() — приватный метод, генерирует событие basket:changed

## Класс Buyer
Хранит данные покупателя.

Поля:
payment: string — способ оплаты

address: string — адрес доставки

phone: string — телефон

email: string — почта

Методы:
setField(field, value) — заполняет поле, валидирует и эмитит событие buyer:changed

getData() — возвращает объект с данными покупателя

clearData() — очищает все поля и эмитит событие buyer:changed

validate() — проверяет заполненность и возвращает объект ошибок

# Слой коммуникации
## Класс ServerCommunication
Отвечает за работу с API.

Поля:
api: IApi — объект API

Методы:
loadProductList() — загружает список товаров

sendOrder(order: IOrderRequest) — отправляет заказ

# Слой представления (View)
## Класс BaseCard
Базовый класс карточек.

Поля:
titleEl: HTMLElement — элемент заголовка

priceEl: HTMLElement — элемент цены

Методы:
render() — рендер карточки

id (setter) — установка ID

title (setter) — установка названия

price (setter) — установка цены

## Класс CardListItem
Карточка товара в каталоге.

Поля:
imageEl: HTMLImageElement — картинка

categoryEl: HTMLElement — категория

Методы:
image(src: string) — установка изображения

category(value: string) — установка категории

render() — возвращает контейнер

## Класс CardDetail
Карточка товара в модальном окне.

Поля:
actionBtn: HTMLButtonElement — кнопка действия

imageEl: HTMLImageElement — картинка

categoryEl: HTMLElement — категория

textEl: HTMLElement — описание

## Класс CardCartItem
Карточка товара в корзине.

Поля:
removeBtn: HTMLButtonElement — кнопка удаления

indexEl: HTMLElement | null — индекс

## Класс CatalogView
Представление каталога товаров.

Поля:
container: HTMLElement — корневой элемент

Методы:
constructor(root: HTMLElement) — принимает корневой элемент и вызывает базовый конструктор

render(nodes: HTMLElement[]) — принимает готовые узлы карточек, вставляет их в контейнер и возвращает контейнер

## Класс ModalView
Модальное окно.

Поля:
content: HTMLElement — содержимое

closeBtn: HTMLButtonElement — кнопка закрытия

## Класс ContactsFormView
Форма контактов.

Поля:
emailInput: HTMLInputElement — поле ввода email

phoneInput: HTMLInputElement — поле ввода телефона

submitBtn: HTMLButtonElement — кнопка отправки формы

errorsEl: HTMLElement — элемент для отображения ошибок

Методы:
constructor(template: HTMLTemplateElement) — клонирует шаблон, инициализирует элементы формы и навешивает обработчики событий:

contacts:email при вводе email

contacts:phone при вводе телефона

contacts:submit при отправке формы

errors (setter) — отображает ошибки и блокирует кнопку отправки при их наличии

clear() — очищает поля формы и сбрасывает ошибки

## Класс OrderFormView
Форма заказа.

Поля:
cardBtn: HTMLButtonElement — выбор оплаты картой

cashBtn: HTMLButtonElement — выбор оплаты наличными

addressInput: HTMLInputElement — ввод адреса

submitBtn: HTMLButtonElement

errorsEl: HTMLElement

payment: string

address: string

Класс SuccessView
Экран успешного заказа.

Поля:
titleEl: HTMLElement — заголовок

descriptionEl: HTMLElement — описание

closeBtn: HTMLButtonElement — кнопка закрытия

## Класс CartView
Представление корзины.

Поля:
listEl: HTMLElement — список товаров

totalEl: HTMLElement — элемент для отображения суммы

checkoutBtn: HTMLButtonElement — кнопка оформления заказа

Методы:
constructor(template: HTMLTemplateElement) — инициализация, навешивает обработчик на кнопку оформления заказа и эмитит событие cart:checkout

items (setter) — принимает готовую разметку списка покупок, обновляет список и состояние кнопки

total (setter) — обновляет стоимость

canCheckout (setter) — включает/отключает кнопку оформления заказа

render() — возвращает контейнер

## Класс HeaderView
Представление шапки сайта.

Поля:
basketBtn: HTMLButtonElement — кнопка корзины

basketCounter: HTMLElement — визуальный счетчик товаров в корзине

Методы:
constructor() — инициализирует элементы шапки, навешивает обработчик клика на кнопку корзины и эмитит событие cart:open

setBasketCount(count: number) — обновляет визуальный счетчик корзины

# Презентер приложения

## Поля
catalog: ProductCatalog — модель каталога товаров

basket: Basket — модель корзины

buyer: Buyer — модель покупателя

catalogView: CatalogView — представление каталога

cartView: CartView — представление корзины

modal: ModalView — модальное окно

headerView: HeaderView — представление шапки сайта

detailTemplate: HTMLTemplateElement — шаблон карточки товара для модального окна

orderForm: OrderFormView — форма заказа (шаг 1)

contactsForm: ContactsFormView — форма контактов (шаг 2)

successView: SuccessView — экран успешного заказа

## Методы и логика
### Вспомогательные функции
updateBasketCounter(count: number) — обновляет визуальный счетчик корзины в шапке

openDetail(id: string) — открывает модальное окно с деталями товара, формирует данные карточки и отображает кнопку действия (купить/удалить/недоступно)

openCart() — открывает текущее состояние корзины в модальном окне

### Подписки на события
##### Каталог

catalog:item:select — выбор товара для просмотра, вызывает openDetail

catalog:changed — обновление списка товаров, рендер карточек в каталоге

Карточка товара (детали)

detail:buy — добавление товара в корзину, закрытие модалки

detail:remove — удаление товара из корзины, обновление счетчика и закрытие модалки

#### Корзина

cart:item:remove — удаление товара из корзины через список, обновление счетчика и повторное открытие корзины

cart:open — открытие корзины

cart:checkout — открытие формы заказа (шаг 1) с текущими данными покупателя

basket:changed — обновление списка карточек корзины, суммы и счетчика в шапке

#### Форма заказа (шаг 1)

order:payment — выбор способа оплаты, обновление модели покупателя

order:address — ввод адреса доставки, обновление модели покупателя

order:next — переход к форме контактов (шаг 2), открытие модалки с формой

#### Форма контактов (шаг 2)

contacts:email — ввод email, обновление модели покупателя

contacts:phone — ввод телефона, обновление модели покупателя

contacts:submit — отправка заказа:

формирование объекта заказа IOrderRequest

отправка на сервер через ServerCommunication

открытие экрана успеха

очистка данных покупателя и корзины

обновление счетчика корзины

### Покупатель

buyer:changed — обновление ошибок в формах заказа и контактов

### Экран успеха

success:close — закрытие модального окна